from socket import *
from RSA_mod import criptografar, decriptografar
from pickle import *

# Nome do arquivo de texto
private_key1d = 635256906172064428986759024910311301284133857380696680870267619454971385225505343739183319499667513644166234766418217532259399575198305944853637863123887729951365984144885662341260498440139054244173111910671707634930987802470642620729992213946682217157857168085521891693592405140108248725684774753020486088786636112237923470774406253265383690767942483209064983292682255599847824979676043680921623112759953752420739653619203997687564239746282518413176559787126858269250652570102699664179757014604265658280728191270446811224550938916536470697930111618112017500248178003128494994641870436330084442077986170786346885131412001627548638877068928698041393986849892147745504836070773452196255481584113221171747443631572844268262299582689778841806891293849954550265174152150339854967069918061608388921726892923277428981202289283899327850611540859265528489191887044288684100840698963956675522516334433909721975847182006411754785016953364679341710572919087299702410158254602127434977161422298972163644472948833661928230546973589036377024463082246325475536564320283083359553914213267848943280914802649965553122419831388005478845165668506395196825123827131074757326161158484713661861663846826743514442139692988544759387443917178960240826187557
private_key1N = 30645641398858177623030271035106922886884542538616172750279942956258147347965833116686416543944567820088771996959926617897636078871807228501050596882004803481817217053871159093101755403376417757874002920827361245693405220077150794379955995691939389598493091921691375416050122288425428096329924575073814625706019265452314396623643803507663983385524442861388371031419022710631879895877727768826494805314177939867571497202862741288988304945023716453333568125477381767175503689076599497139685325546305232772113955379370944108300483083297617287024536243838760195873076022979029754493929806975377457409902547480472907224487780966877058067284768722274136108671816287846457571440659818480293549595989937689121293204985124678834277400649073006455080439481371861885125246066336814048083662728207490291616681369887456709347984299375182059744157357367736785216806223966926131643231780585341088575416354245233821009265594924085933940239286717399001298233446532304516467061502998166984630762179509581204392114262377835026079544492407086155542816526147385939835768473581297131462739285496777152583065679943958569192717422972746965366799390874403049163629854089259731316972888753511208892961836038698815116205365415903983455756171528527838348908561
private_key2d = 155930188256271477905963204630271905159356216044965452995397046001683635643404048126122216025164093305717099342636435376311665996366592883427727200142662143903951291550306961596839719450844936963606492053240932106199687825096744593644475133807097522998982016301922206215020453498466972920166646706526134974782472452971898117853763690145950549898290327665874869576396949802251693076974769249102053437358395808231037438822157174269685546300434760045066908699047052460676809967151556765922828619598233418048559791107610888282654208627570897966177668817845071868129964515282166578246185479691439992419404940930345573823242736837169375445382640140906466988743777664720691278640095830152401190573492800158851438524584966936521615475845739249793964409934338306732525211262048198800673667617875591299418128821324986154301316851492749371498723209497111917553136190952617718253435561794367799552329860347405352990815723499354269741667525592697105342727154128758784159942877179872553811872490206213706174858870205399866729640181705443155043397275990766940773637162692311403889529818925229783929539004513299135526587544315600264734638057283323943869179168716999716396437360929234207322286812604409691610382111741981426673538117202629774211196093
private_key2N = 188592240298343010160696377925109113175946259594458962673426878823967041176192378751784769221913398565318639088767320564177947565779153887067043355766001629231881802569406725858158515134562973869788572827747389896195016025813944797720037557644492076901242632042659194209545258777592824455487327204911071128366221979822802220927072829341139420205232483275958688265386371660183284951859439510537854342605109297372965734170847990039589655570689711224503409526560999209922691133272826395553931872825049048362056998676402461254117330296716118629671489628427125090776825062824979273579623577863713378285127580525358949298185867987797051812305625998338605550576307977097243475724496707727847219469199673641496428368565615184734602158179443719801641990373414456249008658672176778973368776272443612183113963589115561166072701804434456528775965187959317946240096926048795957914761868561645775227583595074091256906353793249831049981099744415894503284267394026009971912257171786478944378203789311750406894294100121404471632835771084575260845976044661628946095962597583497709301211076698560187617750010426662300246530218994197351673038921887414093127214872378200295544884547766180649139034798583762390261684148893398193857792326747099260551690501

public_key1e = 22329049031221240319083361538564869674079260091580282823385478605409899112428426969239452744339385599408623585257099386256543288691797724006558762508822944246520713268881329755931034465390755098075381033142742844754867532836974777271866174049907397230950178509368031233646551212924695806186479325345288855772370186415538588982724758575251951952983761026072686996749959123887635048949571771343581877674425803715741196498893837901505687504492587132352931657914708095467956034055100493260435248673553510562917989484290866836431228223550181112431157145766649404459276276458946754948181274460425467270947428950361014883278943383797767640776959901526606102722501202061432207265972813564915656557976167031999125153652295979456929194495118807330273391092360082987212479168594664031338678981424258077593210467539487986766539818445536180353515461235490210348256285327303820245122188654153397748783879434133552142174396257009225320704022754376391279994774722421895438506062759711437139094755647059585912638429473105770733440387491121573012656917496383171837213646171803256553219086352140956141829753205452106340750791333440688922911121688641524076119223421200650424475950665179976210441560167549975203096164350496104533102012875330533835419317
public_key1N = 30645641398858177623030271035106922886884542538616172750279942956258147347965833116686416543944567820088771996959926617897636078871807228501050596882004803481817217053871159093101755403376417757874002920827361245693405220077150794379955995691939389598493091921691375416050122288425428096329924575073814625706019265452314396623643803507663983385524442861388371031419022710631879895877727768826494805314177939867571497202862741288988304945023716453333568125477381767175503689076599497139685325546305232772113955379370944108300483083297617287024536243838760195873076022979029754493929806975377457409902547480472907224487780966877058067284768722274136108671816287846457571440659818480293549595989937689121293204985124678834277400649073006455080439481371861885125246066336814048083662728207490291616681369887456709347984299375182059744157357367736785216806223966926131643231780585341088575416354245233821009265594924085933940239286717399001298233446532304516467061502998166984630762179509581204392114262377835026079544492407086155542816526147385939835768473581297131462739285496777152583065679943958569192717422972746965366799390874403049163629854089259731316972888753511208892961836038698815116205365415903983455756171528527838348908561
public_key2e = 93286754277489880724202896485526865480620259494040242957045070735079454076426070852737012351319593281961507316870162812132549559694523999474459034846174544516175449308448514025892520108284396053509378316245584435291849566167424924327585006978020976718260221243492226278285673296739939464506866284006284863827411209447976775196986252069368342899485950854163880639644369152815885061223594778817250137824011998205829734684677522758506922151044104476202678842351679954436855099098607772748889844187287807874402525283319123394030156160935244800669963699591257995680316475157862270832949770532067604314088478745836902755513256816755616097007911764667264176336256128343882567201278993596246405425566787046332469365116340087280754156661962190715998719206578251900197935500342057965093187684818030813590937377866639523462815137731421973986562099520786421874304031518878967689033674792537423421164941929236421042875485068778834906707160037488853289581927096212998020658880510740100450905701793081331002831106412292050934872995051481777974423664934842538291051900861316064062172413567768460512257676259116137667524837376376381963284134835526642125806352230865093326300420257789952820796367194887162410926223788265459870330926668633848764072213
public_key2N = 188592240298343010160696377925109113175946259594458962673426878823967041176192378751784769221913398565318639088767320564177947565779153887067043355766001629231881802569406725858158515134562973869788572827747389896195016025813944797720037557644492076901242632042659194209545258777592824455487327204911071128366221979822802220927072829341139420205232483275958688265386371660183284951859439510537854342605109297372965734170847990039589655570689711224503409526560999209922691133272826395553931872825049048362056998676402461254117330296716118629671489628427125090776825062824979273579623577863713378285127580525358949298185867987797051812305625998338605550576307977097243475724496707727847219469199673641496428368565615184734602158179443719801641990373414456249008658672176778973368776272443612183113963589115561166072701804434456528775965187959317946240096926048795957914761868561645775227583595074091256906353793249831049981099744415894503284267394026009971912257171786478944378203789311750406894294100121404471632835771084575260845976044661628946095962597583497709301211076698560187617750010426662300246530218994197351673038921887414093127214872378200295544884547766180649139034798583762390261684148893398193857792326747099260551690501


serverPort = 1300
serverSocket = socket(AF_INET,SOCK_STREAM)
serverSocket.bind(("",serverPort))
serverSocket.listen(5) # o argumento “listen” diz à biblioteca de soquetes que queremos enfileirar no máximo 5 requisições de conexão (normalmente o máximo) antes de recusar começar a recusar conexões externas. Caso o resto do código esteja escrito corretamente, isso deverá ser o suficiente.
print ("TCP Server\n")
connectionSocket, addr = serverSocket.accept()
sentence = connectionSocket.recv(65000)

#received = str(sentence,"utf-8")
data_arr = loads(sentence)
print ("Texto encriptado recebido: ", data_arr)

textoDecriptografado = decriptografar(private_key2d, private_key2N, data_arr)
print ("Texto Decriptografado: ", textoDecriptografado)

textoDecriptografado= textoDecriptografado.upper()

textoCriptografado = criptografar(public_key1e, public_key1N, textoDecriptografado)
print ("Texto Criptografado para reenviar: ", textoDecriptografado)

data_to_send = dumps(textoCriptografado)
connectionSocket.send(data_to_send)

#sent = str(textoCriptografado,"utf-8")
print ("Sent back to Client: ", data_to_send)
connectionSocket.close()
